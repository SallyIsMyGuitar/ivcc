template: tesla-powerwall
products:
  - brand: Tesla
    description:
      generic: Powerwall
capabilities: ["battery-control"]
requirements:
  description:
    de: |
      Um die optionale Entladesteuerung der Battery zu nutzen, werden ein `access` und ein `refresh` Token benötigt.
      Diese kannst du über [tesla.evcc.io](https://tesla.evcc.io) erstellen.
    en: |
      For optional battery control `access` and `refresh` tokens are required.
      Please generate them through [tesla.evcc.io](https://tesla.evcc.io).
params:
  - name: usage
    choice: ["grid", "pv", "battery"]
    allinone: true
  - name: host
  - name: password
    required: true
    help:
      en: Password of the user "customer". By default this is the last 5 characters of password stated on the Tesla Gateway.
      de: Passwort des Benutzers "Kunde". Default sind die letzten 5 Zeichen des auf dem Tesla Gateway genannten Passworts.
  - name: accessToken
    help:
      en: "See https://docs.evcc.io/en/docs/devices/meters#tesla-powerwall"
      de: "Siehe https://docs.evcc.io/docs/devices/meters#tesla-powerwall"
  - name: refreshToken
    help:
      en: "See https://docs.evcc.io/en/docs/devices/meters#tesla-powerwall"
      de: "Siehe https://docs.evcc.io/docs/devices/meters#tesla-powerwall"
  - name: siteId
    help:
      en: optional product identifier of the energy site, use to override autodectction
      de: optionale Product ID dieser Energy Site, zum Übersteuern der automatischen Erkennung
  - name: minSoc
    type: number
    advanced: true
    help:
      en: the battery reserve percentage to reset to when switching the Battery back to normal operations
      de: die Energyreserve auf die zurückgesetzt wird, wenn die Entladung wieder freigegeben wird
  - name: maxSoc
    type: number
    advanced: true
    help:
      en: the battery reserve percentage to set to when switching the Battery to charge mode
      de: die Energyreserve auf die gesetzt wird, wenn Batterieladung angefordert wird
render: |
  type: powerwall
  uri: {{ .host }}
  usage: {{ .usage }}
  user: customer
  password: {{ .password }} # for user 'customer'
  tokens:
    access: {{ .accessToken }}
    refresh: {{ .refreshToken }}
  siteId: {{ .siteId }}
  minSoc: {{ .minSoc }}
  maxSoc: {{ .maxSoc }}
