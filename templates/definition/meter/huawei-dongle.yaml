template: huawei-dongle
products:
- brand: Huawei
  description:
    generic: SUN2000 with Sdongle
guidedsetup:
  enable: true
params:
- name: usage
  choice: [ "pv", "battery" ]
- name: modbus
  choice: ["tcpip"]
render: |
  type: custom
  {{- if eq .usage "pv" }}
  power:
    source: modbus
    {{include "modbus" . | indent 2}}
    model: huawei
    timeout: 30s
    connectdelay: 5s
    delay: 2s
    register:
      address: 32080 # Active generation power
      type: holding
      decode: int32
  {{- end }}
  {{- if eq .usage "battery" }}
  power:
    source: modbus
    {{include "modbus" . | indent 2}}
    model: huawei
    timeout: 30s
    connectdelay: 5s
    delay: 2s
    register:
      address: 37001
      type: holding
      decode: int32
  soc:
    source: modbus
    {{include "modbus" . | indent 2}}
    model: huawei
    timeout: 30s
    connectdelay: 5s
    delay: 2s
    register:
      address: 37004
      type: holding
      decode: uint16
    scale: 0.1
  {{- end }}
