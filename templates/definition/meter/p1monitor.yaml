template: p1monitor
products:
  - brand: P1Monitor
    description:
      generic: P1 Monitor
params:
  - name: usage
    choice: ["grid"]
  - name: host
render: |
  {{- define "uri" -}}
  http://{{ .host }}
  {{- end }}
  type: custom
  power:  
    source: calc
    add:
    - source: http
      uri: {{ include "uri" . }}/api/v1/status/74
      method: GET
      jq: .[0].[1]
      scale: 1000
    - source: http
      uri: {{ include "uri" . }}/api/v1/status/75
      method: GET
      jq: .[0].[1]
      scale: 1000
    - source: http
      uri: {{ include "uri" . }}/api/v1/status/76
      method: GET
      jq: .[0].[1]
      scale: 1000
    - source: http
      uri: {{ include "uri" . }}/api/v1/status/77
      method: GET
      jq: .[0].[1]
      scale: -1000
    - source: http
      uri: {{ include "uri" . }}/api/v1/status/78
      method: GET
      jq: .[0].[1]
      scale: -1000
    - source: http
      uri: {{ include "uri" . }}/api/v1/status/79
      method: GET
      jq: .[0].[1]
      scale: -1000
  energy:
    source: calc
    add:
    - source: http
      uri: {{ include "uri" . }}/api/v1/smartmeter?limit=1
      method: GET
      jq: .[0].[3]
    - source: http
      uri: {{ include "uri" . }}/api/v1/smartmeter?limit=1
      method: GET
      jq: .[0].[4]
  currents:
  - source: http
    uri: {{ include "uri" . }}/api/v1/status/100
    jq: .[0].[1]
  - source: http
    uri: {{ include "uri" . }}/api/v1/status/101
    jq: .[0].[1]
  - source: http
    uri: {{ include "uri" . }}/api/v1/status/102
    jq: .[0].[1]
