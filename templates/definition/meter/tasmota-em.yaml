template: tasmota-em
products:
  - brand: Tasmota
  - description:
      generic: 3 Phase Tasmota Firmware Meter
params:
  - name: usage
    choice: ["pv", "battery", "charge"]
  - name: host
  - name: user
    required: false
    help:
      de: Standard-User ist admin
      en: admin is default
  - name: password
    required: false
    mask: true
render: |
  {{- define "uri" -}}
  http://{{ if .user }}{{ .user }}:{{ .password }}@{{ end }}{{ .host }}
  {{- end }}
  type: custom
  power:
    source: http
    uri: {{ include "uri" . }}/cm?cmnd=Status+8
    jq: .StatusSNS.ENERGY.Power | add
  energy: # Energiemenge (kWh)
    source: http
    uri: {{ include "uri" . }}/cm?cmnd=Status+8
    jq: .StatusSNS.ENERGY.Total
  currents: # Stromst√§rke (A) pro Phase
    - source: http
      uri: {{ include "uri" . }}/cm?cmnd=Status+8
      jq: .StatusSNS.ENERGY.Current[0]
    - source: http
      uri: {{ include "uri" . }}/cm?cmnd=Status+8
      jq: .StatusSNS.ENERGY.Current[1]
    - source: http
      uri: {{ include "uri" . }}/cm?cmnd=Status+8
      jq: .StatusSNS.ENERGY.Current[2]
  voltages: # Spannung (V) pro Phase
    - source: http
      uri: {{ include "uri" . }}/cm?cmnd=Status+8
      jq: .StatusSNS.ENERGY.Voltage[0]
    - source: http
      uri: {{ include "uri" . }}/cm?cmnd=Status+8
      jq: .StatusSNS.ENERGY.Voltage[1]
    - source: http
      uri: {{ include "uri" . }}/cm?cmnd=Status+8
      jq: .StatusSNS.ENERGY.Voltage[2]
